// GLOBALS: 
var ZOOMLEVEL = 14;
var map;

// POSISJONER:
var BOE_LATLONG 		= [59.41085, 9.07256];
var RINGERRIKE_LATLONG 	= [60.14, 10.25];

// WMS TJENESTER: 
var ROAD_LAYER_URL 	  =  "http://openwms.statkart.no/skwms1/wms.vegnett?";
var ADDRESS_LAYER_URL =  "http://wms.geonorge.no/skwms1/wms.matrikkel.v1?request=G";

function initializeMap( position )
{
 	// INITIALIZING THE MAIN MAP:
 	map = L.map('map').setView(BOE_LATLONG, ZOOMLEVEL);

    L.tileLayer('http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=norges_grunnkart&zoom={z}&x={x}&y={y}',
    {
        attribution: '<a href="http://www.kartverket.no/">Kartverket</a>'
    }).addTo(map);

    function onMapClick(e) {
    	var marker = L.marker(e.latlng).addTo(map);
    	marker.bindPopup("koordinater: "+e.latlng);
	}
	map.on('click', function (e) {
		console.log("[ "+e.latlng.lat + ", " + e.latlng.lng + " ]");
	});
}

function setRoadLayer() 
{	
	var wmsLayer = L.tileLayer.wms(ROAD_LAYER_URL, {
		layers: "all", 
		format: 'image/png',
		transparent: "true"
	}).addTo(map);
}

function placeBusStops( pos )
{
	var stops = getBusstops( pos[0], pos[1] );
	for(var i = 0; i < stops.length; i++)
	{
		var id = stops[i].id;
		if (id == undefined) continue;

		var icon = placeIcon(BUS_STOP_ICON,  stops[i].latitude, stops[i].longitude );
		icon.on("click", function(e)
		{
			if (selected_from != undefined)
			{
				selectTo( id );
				updatePlannerInfoToData( id) ;
			}
			else plannerInfoFill( id );

			$("#meny").animate({bottom: "0"}, 500);

		});
	}
}

// Setter ut bussholdeplasser der du befinner der



// Finner og legger ikon på hotspots
function placeHotspots( position ) 
{

	for(var i = 0; i < 500; i++)
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.41379, 9.08344 );
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.40251, 9.07118 );
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.45236, 9.06837 );
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.4445, 9.06331 );
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.43936, 9.08228 );
		placeIcon(AVAILABLE_HOTSPOT_ICON,  59.43681, 9.06845 );
		placeIcon(ACTIVE_HOTSPOT_ICON,  59.41982, 9.07735 );
		placeIcon(ACTIVE_HOTSPOT_ICON,  59.41513, 9.07677 );
		placeIcon(ACTIVE_HOTSPOT_ICON,  59.4264, 9.0815 );
		placeIcon(ACTIVE_HOTSPOT_ICON,  59.42344, 9.0626 );
		placeIcon(ACTIVE_HOTSPOT_ICON,  59.41864, 9.0555 );

}
/*
var tilHotspotAvkjørsel = new Array(
	[ 59.409934827875624, 9.083681702613832 ]
	[ 59.409951207333314, 9.083552956581117 ],
	[ 59.40996485687533, 9.083445668220522 ],
	[ 59.410019454988415, 9.083161354064943 ],
	[ 59.41004948391311, 9.0829735994339 ],
	[ 59.41008770250601, 9.08274292945862 ],
	[ 59.41014503031454, 9.082410335540773 ],
	[ 59.41019416835889, 9.082099199295046 ],
	[ 59.41023238678855, 9.081889986991884 ],
	[ 59.41027879482372, 9.081616401672365 ],
	[ 59.4103142832783, 9.081412553787233 ],
	[ 59.41034431194161, 9.081214070320131 ],
	[ 59.41038798994978, 9.080961942672731 ],
	[ 59.4104289380313, 9.08073127269745 ],
	[ 59.410467156196056, 9.080516695976259 ],
	[ 59.41049445485877, 9.080328941345217 ],
	[ 59.41052994308739, 9.080125093460085 ],
	[ 59.41057089099729, 9.079894423484804 ],
	[ 59.41060364928956, 9.079679846763613 ],
	[ 59.41065278666858, 9.079406261444094 ],
	[ 59.41069646427897, 9.079148769378664 ],
	[ 59.41073741198756, 9.078934192657472 ],
	[ 59.41077289996163, 9.078714251518251 ],
	[ 59.41080019837791, 9.078521132469179 ],
	[ 59.410824766933736, 9.078392386436464 ]
);

var tilHotspotStop = new Array(
	[ 59.41089028299555, 9.07824754714966 ],
	[ 59.41095306910251, 9.078290462493898 ],
	[ 59.411018584916114, 9.078317284584047 ],
	[ 59.41112504784294, 9.078365564346315 ],
	[ 59.411206942174346, 9.078408479690554 ],
	[ 59.411277917101344, 9.078446030616762 ],
	[ 59.41136254085842, 9.078462123870851 ],
	[ 59.41142805587997, 9.078472852706911 ],
	[ 59.411512679261925, 9.078472852706911 ],
	[ 59.411575464215126, 9.078472852706911 ],
	[ 59.41163005973199, 9.078467488288881 ],
	[ 59.411698304004325, 9.078462123870851 ],
	[ 59.41176381837641, 9.078472852706911 ],
	[ 59.41184571116329, 9.07847821712494 ],
	[ 59.41191941450215, 9.07847821712494 ],
	[ 59.41196036073224, 9.078472852706911 ],
	[ 59.41202587459738, 9.078488945961 ],
	[ 59.41209411807217, 9.07851576805115 ],
	[ 59.41217328033066, 9.078580141067507 ],
	[ 59.41225244240408, 9.078655242919924 ],
	[ 59.41231795570426, 9.07872498035431 ],
	[ 59.41237255002427, 9.078800082206728 ],
	[ 59.4124407928005, 9.078907370567324 ],
	[ 59.41249811662628, 9.07901465892792 ],
	[ 59.41253360275553, 9.079100489616396 ],
	[ 59.41258000763765, 9.079213142395021 ],
	[ 59.41262641245621, 9.079347252845766 ],
	[ 59.412667357831545, 9.07948672771454 ],
	[ 59.41269192503298, 9.079599380493166 ],
	[ 59.41271376253041, 9.079701304435732 ],
	[ 59.4127410593824, 9.079830050468447 ],
	[ 59.41276289684815, 9.079964160919191 ],
	[ 59.41278746398028, 9.080098271369936 ],
	[ 59.41282022012874, 9.080221652984621 ],
	[ 59.41285024657033, 9.080334305763246 ],
	[ 59.41286662461815, 9.080430865287783 ],
	[ 59.41291029937363, 9.080602526664736 ],
	[ 59.412943055403304, 9.080693721771242 ],
	[ 59.41297035207047, 9.080795645713808 ],
	[ 59.413005837704894, 9.080902934074404 ],
	[ 59.413049512280864, 9.081037044525148 ],
	[ 59.41308226817586, 9.081155061721804 ],
	[ 59.41312321300007, 9.081283807754518 ],
	[ 59.41315869847435, 9.081380367279055 ],
	[ 59.41319145426375, 9.08149302005768 ],
	[ 59.413226939666515, 9.081589579582216 ],
	[ 59.41325969538992, 9.081675410270693 ],
	[ 59.413289721441885, 9.081771969795229 ],
	[ 59.413317017829634, 9.081863164901735 ],
	[ 59.41334704383076, 9.081948995590212 ],
	[ 59.413382529070525, 9.082050919532778 ],
	[ 59.41341528464342, 9.082142114639284 ],
	[ 59.41344258092998, 9.08222794532776 ],
	[ 59.41347533644482, 9.082281589508058 ],
	[ 59.41350809192797, 9.082388877868654 ],
	[ 59.413546306618294, 9.08250689506531 ],
	[ 59.41358452126545, 9.082608819007875 ],
	[ 59.413617276643016, 9.082716107368471 ],
	[ 59.41364730237794, 9.082812666893007 ],
	[ 59.41367732808623, 9.082893133163454 ],
	[ 59.41370189455505, 9.0829735994339 ],
	[ 59.413729190610596, 9.083048701286318 ],
	[ 59.4137510274392, 9.083139896392824 ],
	[ 59.41378378265572, 9.08324182033539 ],
	[ 59.413816537840546, 9.083354473114015 ],
	[ 59.41384110420837, 9.083434939384462 ]
);

var fraHotspotAvkjørsel = new Array[
	[ 59.410884823328566, 9.078177809715273 ]
	[ 59.41088755316216, 9.07801687717438 ]
	[ 59.410893012828694, 9.077861309051515 ]
	[ 59.4109066619912, 9.077678918838503 ]
	[ 59.41092304097891, 9.077523350715639 ]
	[ 59.41092577080945, 9.077394604682924 ]
	[ 59.41092850063974, 9.077281951904299 ]
	[ 59.410936690129304, 9.077163934707643 ]
	[ 59.41093941995873, 9.077056646347048 ]
	[ 59.41094214978792, 9.076960086822512 ]
	[ 59.41094487961691, 9.076863527297975 ]
	[ 59.41094760944565, 9.076718688011171 ]
	[ 59.41095306910251, 9.076568484306337 ]
	[ 59.41095852875848, 9.076450467109682 ]
	[ 59.41096125858615, 9.076343178749086 ]
	[ 59.410963988413585, 9.07625198364258 ]
	[ 59.41096125858615, 9.076123237609865 ]
	[ 59.41097217789458, 9.0760213136673 ]
	[ 59.410974907721126, 9.075935482978823 ]
	[ 59.410974907721126, 9.075838923454286 ]
	[ 59.41097763754747, 9.07573163509369 ]
	[ 59.4109830971995, 9.075624346733095 ]
	[ 59.410988556850604, 9.07552242279053 ]
	[ 59.410996746325665, 9.075436592102053 ]
	[ 59.41100493579874, 9.075334668159487 ]
	[ 59.41100493579874, 9.0752649307251 ]
	[ 59.41101039544635, 9.075157642364504 ]
	[ 59.41102404456153, 9.075050354003908 ]
	[ 59.41103496384973, 9.074975252151491 ]
	[ 59.4110513427754, 9.074867963790895 ]
	[ 59.411067721693165, 9.07474994659424 ]
	[ 59.41108410060301, 9.074674844741823 ]
	];
*/